<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian STRAT Scanner - Live Zerodha Data</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: system-ui, -apple-system, sans-serif;
            background-color: #f9fafb;
        }
        .animate-spin { animation: spin 1s linear infinite; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .live-indicator { animation: livePulse 2s infinite; }
        @keyframes livePulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        .error-boundary {
            padding: 20px;
            text-align: center;
            background: #fee;
            border: 1px solid #fcc;
            border-radius: 8px;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; flex-direction: column;">
            <div style="width: 64px; height: 64px; border: 4px solid #f3f3f3; border-top: 4px solid #ea580c; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 16px;"></div>
            <p>Loading Indian STRAT Scanner...</p>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { createRoot } = ReactDOM;

        function IndianStratScanner() {
            const [stocks, setStocks] = useState([]);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('scan');
            const [connectionStatus, setConnectionStatus] = useState('demo');
            const [lastUpdate, setLastUpdate] = useState(null);
            const [autoRefresh, setAutoRefresh] = useState(false);
            const [apiConfig, setApiConfig] = useState({
                apiKey: '',
                accessToken: '',
                apiSecret: ''
            });
            const [showApiConfig, setShowApiConfig] = useState(false);
            const [debugInfo, setDebugInfo] = useState([]);
            const [showDebug, setShowDebug] = useState(false);
            const intervalRef = useRef(null);
            const [error, setError] = useState(null);

            // Enhanced environment variable loading for Netlify
            useEffect(() => {
                let envApiKey = '';
                let envApiSecret = '';
                let envAccessToken = '';
                
                // Method 1: Try process.env (Netlify build time)
                if (typeof process !== 'undefined' && process.env) {
                    envApiKey = process.env.REACT_APP_KITE_API_KEY || '';
                    envApiSecret = process.env.REACT_APP_KITE_API_SECRET || '';
                    envAccessToken = process.env.REACT_APP_KITE_ACCESS_TOKEN || '';
                }
                
                // Method 2: Try window._env_ (Netlify runtime injection)
                if (!envApiKey && typeof window !== 'undefined' && window._env_) {
                    envApiKey = window._env_.REACT_APP_KITE_API_KEY || '';
                    envApiSecret = window._env_.REACT_APP_KITE_API_SECRET || '';
                    envAccessToken = window._env_.REACT_APP_KITE_ACCESS_TOKEN || '';
                }
                
                // Method 3: Try window.ENV (alternative Netlify format)
                if (!envApiKey && typeof window !== 'undefined' && window.ENV) {
                    envApiKey = window.ENV.REACT_APP_KITE_API_KEY || '';
                    envApiSecret = window.ENV.REACT_APP_KITE_API_SECRET || '';
                    envAccessToken = window.ENV.REACT_APP_KITE_ACCESS_TOKEN || '';
                }

                // Method 4: Hardcode for testing (temporary)
                if (!envApiKey) {
                    // Use your actual values from Netlify env:list
                    envApiKey = 'vyp8y4w3g7s87881';
                    envApiSecret = 'pd5bol5wz7geyh1nq1omfubtv4z0ttv';
                    envAccessToken = 'REPLACE_WITH_NEW_ACCESS_TOKEN'; // Replace this with fresh token
                    
                    setDebugInfo(prev => [...prev, {
                        symbol: 'ENV',
                        status: 'WARNING',
                        message: 'Using hardcoded credentials - UPDATE ACCESS TOKEN NEEDED'
                    }]);
                }
                
                if (envApiKey) {
                    setApiConfig(prev => ({
                        ...prev,
                        apiKey: envApiKey,
                        apiSecret: envApiSecret,
                        accessToken: envAccessToken
                    }));
                    
                    setDebugInfo(prev => [...prev, {
                        symbol: 'ENV',
                        status: 'SUCCESS',
                        message: `Credentials loaded - API Key: ${envApiKey.substring(0, 8)}..., Secret: ${envApiSecret ? 'SET' : 'MISSING'}, Token: ${envAccessToken ? 'SET' : 'MISSING'}`
                    }]);
                } else {
                    setDebugInfo(prev => [...prev, {
                        symbol: 'ENV',
                        status: 'ERROR',
                        message: 'Environment variables not accessible - use manual config'
                    }]);
                }

                // Check for OAuth callback
                const urlParams = new URLSearchParams(window.location.search);
                const requestToken = urlParams.get('request_token');
                const status = urlParams.get('status');
                
                if (requestToken && status === 'success') {
                    handleOAuthCallback(requestToken);
                }

                // Check for stored token
                checkStoredToken();
            }, []);

            // Check for stored access token
            const checkStoredToken = () => {
                const storedToken = localStorage.getItem('kite_access_token');
                const tokenDate = localStorage.getItem('kite_token_date');
                const today = new Date().toDateString();
                
                if (storedToken && tokenDate === today) {
                    setApiConfig(prev => ({
                        ...prev,
                        accessToken: storedToken
                    }));
                    setDebugInfo(prev => [...prev, {
                        symbol: 'TOKEN',
                        status: 'SUCCESS',
                        message: 'Valid access token found'
                    }]);
                } else if (storedToken && tokenDate !== today) {
                    localStorage.removeItem('kite_access_token');
                    localStorage.removeItem('kite_token_date');
                    setDebugInfo(prev => [...prev, {
                        symbol: 'TOKEN',
                        status: 'WARNING',
                        message: 'Access token expired'
                    }]);
                }
            };

            // Handle OAuth callback with proper form encoding
            const handleOAuthCallback = async (requestToken) => {
                try {
                    setDebugInfo(prev => [...prev, {
                        symbol: 'OAUTH',
                        status: 'PROCESSING',
                        message: `Processing request token: ${requestToken.substring(0, 10)}...`
                    }]);

                    // Debug: Log the credentials being used
                    setDebugInfo(prev => [...prev, {
                        symbol: 'OAUTH',
                        status: 'INFO',
                        message: `Using API Key: ${apiConfig.apiKey?.substring(0, 8)}..., Secret: ${apiConfig.apiSecret ? 'provided' : 'missing'}`
                    }]);

                    // Create proper form data
                    const formBody = new URLSearchParams();
                    formBody.append('request_token', requestToken);
                    formBody.append('api_key', apiConfig.apiKey);
                    formBody.append('api_secret', apiConfig.apiSecret);

                    // Debug: Log what we're sending
                    setDebugInfo(prev => [...prev, {
                        symbol: 'OAUTH',
                        status: 'INFO',
                        message: `Sending form data: request_token=${requestToken.substring(0, 10)}..., api_key=${apiConfig.apiKey?.substring(0, 8)}...`
                    }]);

                    const response = await fetch('/.netlify/functions/generate-access-token', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: formBody.toString()
                    });

                    setDebugInfo(prev => [...prev, {
                        symbol: 'OAUTH',
                        status: 'INFO',
                        message: `Server response status: ${response.status}`
                    }]);

                    const responseText = await response.text();
                    setDebugInfo(prev => [...prev, {
                        symbol: 'OAUTH',
                        status: 'INFO',
                        message: `Server response: ${responseText.substring(0, 200)}...`
                    }]);

                    if (response.ok) {
                        const data = JSON.parse(responseText);
                        
                        if (data.status === 'success' && data.data && data.data.access_token) {
                            const accessToken = data.data.access_token;
                            
                            setApiConfig(prev => ({
                                ...prev,
                                accessToken: accessToken
                            }));
                            
                            // Store token
                            localStorage.setItem('kite_access_token', accessToken);
                            localStorage.setItem('kite_token_date', new Date().toDateString());
                            
                            setDebugInfo(prev => [...prev, {
                                symbol: 'OAUTH',
                                status: 'SUCCESS',
                                message: `âœ… Access token generated successfully: ${accessToken.substring(0, 10)}...`
                            }]);
                            
                            // Clear URL parameters
                            window.history.replaceState({}, document.title, window.location.pathname);
                            
                        } else {
                            throw new Error(data.message || `API returned: ${JSON.stringify(data)}`);
                        }
                    } else {
                        throw new Error(`HTTP ${response.status}: ${responseText}`);
                    }
                } catch (error) {
                    console.error('OAuth callback error:', error);
                    setDebugInfo(prev => [...prev, {
                        symbol: 'OAUTH',
                        status: 'ERROR',
                        message: `âŒ OAuth failed: ${error.message}`
                    }]);
                }
            };

            // Initiate real Kite login
            const initiateKiteLogin = () => {
                if (!apiConfig.apiKey) {
                    alert('Please configure API Key first in environment variables or manual config.');
                    return;
                }
                
                // Real Kite Connect OAuth flow
                const loginUrl = `https://kite.trade/connect/login?api_key=${apiConfig.apiKey}&v=3`;
                setDebugInfo(prev => [...prev, {
                    symbol: 'OAUTH',
                    status: 'INFO',
                    message: `Redirecting to Kite Connect login: ${loginUrl}`
                }]);
                
                window.location.href = loginUrl;
            };
            const testNetlifyFunctions = async () => {
                setDebugInfo(prev => [...prev, {
                    symbol: 'TEST',
                    status: 'INFO',
                    message: 'Testing Netlify functions...'
                }]);

                // Test kite-quotes function
                try {
                    const response = await fetch('/.netlify/functions/kite-quotes', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            instruments: 'NSE:2953217',
                            api_key: 'test',
                            access_token: 'test'
                        })
                    });
                    
                    if (response.status === 200 || response.status === 500) {
                        setDebugInfo(prev => [...prev, {
                            symbol: 'FUNC1',
                            status: 'SUCCESS',
                            message: 'kite-quotes function exists and responding'
                        }]);
                    } else {
                        setDebugInfo(prev => [...prev, {
                            symbol: 'FUNC1',
                            status: 'ERROR',
                            message: `kite-quotes function error: ${response.status}`
                        }]);
                    }
                } catch (error) {
                    setDebugInfo(prev => [...prev, {
                        symbol: 'FUNC1',
                        status: 'ERROR',
                        message: `kite-quotes function not found: ${error.message}`
                    }]);
                }

                // Test generate-access-token function
                try {
                    const response = await fetch('/.netlify/functions/generate-access-token', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            request_token: 'test',
                            api_key: 'test',
                            api_secret: 'test'
                        })
                    });
                    
                    if (response.status === 200 || response.status === 500) {
                        setDebugInfo(prev => [...prev, {
                            symbol: 'FUNC2',
                            status: 'SUCCESS',
                            message: 'generate-access-token function exists and responding'
                        }]);
                    } else {
                        setDebugInfo(prev => [...prev, {
                            symbol: 'FUNC2',
                            status: 'ERROR',
                            message: `generate-access-token function error: ${response.status}`
                        }]);
                    }
                } catch (error) {
                    setDebugInfo(prev => [...prev, {
                        symbol: 'FUNC2',
                        status: 'ERROR',
                        message: `generate-access-token function not found: ${error.message}`
                    }]);
                }
            };

            // Indian stocks data
            const getIndianStocks = () => {
                return {
                    'TCS': { sector: 'Information Technology', exchange: 'NSE' },
                    'INFY': { sector: 'Information Technology', exchange: 'NSE' },
                    'HDFCBANK': { sector: 'Banking', exchange: 'NSE' },
                    'ICICIBANK': { sector: 'Banking', exchange: 'NSE' },
                    'RELIANCE': { sector: 'Oil & Gas', exchange: 'NSE' },
                    'HINDUNILVR': { sector: 'FMCG', exchange: 'NSE' },
                    'ITC': { sector: 'FMCG', exchange: 'NSE' },
                    'MARUTI': { sector: 'Automobile', exchange: 'NSE' },
                    'TATASTEEL': { sector: 'Metals', exchange: 'NSE' },
                    'SUNPHARMA': { sector: 'Pharmaceuticals', exchange: 'NSE' },
                    'BHARTIARTL': { sector: 'Telecommunications', exchange: 'NSE' },
                    'LT': { sector: 'Construction', exchange: 'NSE' }
                };
            };

            // Generate realistic mock data
            const generateRealisticMockData = (symbol, stockInfo) => {
                const basePrices = {
                    'TCS': 3500, 'INFY': 1400, 'HDFCBANK': 1600, 'ICICIBANK': 950,
                    'RELIANCE': 2800, 'HINDUNILVR': 2600, 'ITC': 450, 'MARUTI': 9800,
                    'TATASTEEL': 140, 'SUNPHARMA': 1100, 'BHARTIARTL': 900, 'LT': 2200
                };

                const basePrice = basePrices[symbol] || 1000;
                const changePercent = (Math.random() - 0.5) * 8;
                const change = (basePrice * changePercent) / 100;
                const currentPrice = basePrice + change;
                const previousClose = basePrice;
                
                const volatility = 0.02;
                const high = currentPrice * (1 + Math.random() * volatility);
                const low = currentPrice * (1 - Math.random() * volatility);
                const open = previousClose * (1 + (Math.random() - 0.5) * volatility);
                const volume = Math.floor(Math.random() * 5000000) + 100000;
                
                return {
                    currentPrice: parseFloat(currentPrice.toFixed(2)),
                    previousClose: parseFloat(previousClose.toFixed(2)),
                    open: parseFloat(open.toFixed(2)),
                    high: parseFloat(high.toFixed(2)),
                    low: parseFloat(low.toFixed(2)),
                    change: parseFloat(change.toFixed(2)),
                    changePercent: parseFloat(changePercent.toFixed(2)),
                    volume: volume,
                    symbol: symbol
                };
            };

            // STRAT analysis
            const calculateSTRATAnalysis = (stockData) => {
                if (!stockData) {
                    return {
                        signal: 'N/A', cc: 'N/A', atr: 'N/A', ftfc: false,
                        inForce: false, setup: 'N/A', actionZone: 'Hold'
                    };
                }

                const { currentPrice, previousClose, high, low, changePercent, open } = stockData;
                
                const dailyRange = ((high - low) / previousClose) * 100;
                const atr = dailyRange;
                
                let candleType = '1';
                let signal = 'Inside';
                let actionZone = 'Hold';
                
                if (dailyRange > 3.5) {
                    candleType = '3';
                    signal = changePercent > 0 ? 'Continuation +' : 'Shooter';
                    actionZone = changePercent > 2 ? 'Buy Zone' : changePercent < -2 ? 'Sell Zone' : 'Caution';
                } else if (Math.abs(changePercent) > 1.2) {
                    candleType = changePercent > 0 ? '2u' : '2d';
                    signal = 'Continuation';
                    actionZone = changePercent > 1.5 ? 'Buy Signal' : changePercent < -1.5 ? 'Sell Signal' : 'Watch';
                }

                const bodySize = Math.abs(currentPrice - open) / previousClose * 100;
                const ftfc = Math.abs(changePercent) > 1 && bodySize > 0.8;
                const inForce = Math.abs(changePercent) > 0.7 && dailyRange > 2;
                
                let setup = 'Orange';
                if (changePercent > 2.5) setup = 'Green';
                else if (changePercent < -2.5) setup = 'Red';
                else if (Math.abs(changePercent) > 1) setup = 'Yellow';

                return {
                    signal, cc: candleType, atr: parseFloat(atr.toFixed(2)),
                    ftfc, inForce, setup, actionZone
                };
            };

            // Fetch stock data with REAL API integration
            const fetchStockData = async () => {
                try {
                    const stocks = getIndianStocks();
                    const stockSymbols = Object.keys(stocks);
                    
                    setDebugInfo([]); // Clear previous debug info
                    
                    // Check if we have REAL API credentials
                    const hasRealCredentials = apiConfig.accessToken && apiConfig.apiKey && 
                                              apiConfig.accessToken.length > 20 && // Real tokens are longer
                                              !apiConfig.accessToken.startsWith('demo_'); // Not our demo token
                    
                    if (hasRealCredentials) {
                        try {
                            setConnectionStatus('connecting');
                            setDebugInfo(prev => [...prev, {
                                symbol: 'API',
                                status: 'CONNECTING',
                                message: 'Attempting real Zerodha API connection...'
                            }]);
                            
                            // Try real Zerodha API call
                            const instrumentTokens = stockSymbols.map(symbol => {
                                // These are example tokens - you need real ones from Zerodha instruments API
                                const tokenMap = {
                                    'TCS': 'NSE:2953217', 'INFY': 'NSE:408065', 'HDFCBANK': 'NSE:341249',
                                    'ICICIBANK': 'NSE:1270529', 'RELIANCE': 'NSE:738561', 'HINDUNILVR': 'NSE:356865',
                                    'ITC': 'NSE:424961', 'MARUTI': 'NSE:2815745', 'TATASTEEL': 'NSE:895745',
                                    'SUNPHARMA': 'NSE:857857', 'BHARTIARTL': 'NSE:2714625', 'LT': 'NSE:2939649'
                                };
                                return tokenMap[symbol] || `NSE:${symbol}`;
                            }).join(',');
                            
                            // Method 1: Direct API call (might fail due to CORS)
                            let quotesData = null;
                            try {
                                const response = await fetch(`https://api.kite.trade/quote?i=${instrumentTokens}`, {
                                    method: 'GET',
                                    headers: {
                                        'Authorization': `token ${apiConfig.apiKey}:${apiConfig.accessToken}`,
                                        'X-Kite-Version': '3'
                                    }
                                });
                                
                                if (response.ok) {
                                    const data = await response.json();
                                    if (data.status === 'success') {
                                        quotesData = data.data;
                                        setConnectionStatus('connected');
                                        setDebugInfo(prev => [...prev, {
                                            symbol: 'API',
                                            status: 'SUCCESS',
                                            message: 'Direct Zerodha API call successful!'
                                        }]);
                                    }
                                }
                            } catch (directError) {
                                setDebugInfo(prev => [...prev, {
                                    symbol: 'API',
                                    status: 'WARNING',
                                    message: `Direct API failed: ${directError.message}`
                                }]);
                            }
                            
                            // Method 2: Netlify Function call (recommended)
                            if (!quotesData) {
                                try {
                                    setDebugInfo(prev => [...prev, {
                                        symbol: 'API',
                                        status: 'INFO',
                                        message: 'Trying Netlify function...'
                                    }]);

                                    const functionResponse = await fetch('/.netlify/functions/kite-quotes', {
                                        method: 'POST',
                                        headers: { 
                                            'Content-Type': 'application/json',
                                            'Accept': 'application/json'
                                        },
                                        body: JSON.stringify({
                                            instruments: instrumentTokens,
                                            api_key: apiConfig.apiKey,
                                            access_token: apiConfig.accessToken
                                        })
                                    });
                                    
                                    setDebugInfo(prev => [...prev, {
                                        symbol: 'API',
                                        status: 'INFO',
                                        message: `Function response status: ${functionResponse.status}`
                                    }]);

                                    if (functionResponse.ok) {
                                        const functionData = await functionResponse.json();
                                        setDebugInfo(prev => [...prev, {
                                            symbol: 'API',
                                            status: 'INFO',
                                            message: `Function response: ${JSON.stringify(functionData).substring(0, 100)}...`
                                        }]);

                                        if (functionData.status === 'success' && functionData.data) {
                                            quotesData = functionData.data;
                                            setConnectionStatus('connected');
                                            setDebugInfo(prev => [...prev, {
                                                symbol: 'API',
                                                status: 'SUCCESS',
                                                message: 'Netlify function API call successful!'
                                            }]);
                                        } else {
                                            setDebugInfo(prev => [...prev, {
                                                symbol: 'API',
                                                status: 'ERROR',
                                                message: `API returned error: ${functionData.message || 'Unknown error'}`
                                            }]);
                                        }
                                    } else {
                                        const errorText = await functionResponse.text();
                                        setDebugInfo(prev => [...prev, {
                                            symbol: 'API',
                                            status: 'ERROR',
                                            message: `Function HTTP error ${functionResponse.status}: ${errorText}`
                                        }]);
                                    }
                                } catch (functionError) {
                                    setDebugInfo(prev => [...prev, {
                                        symbol: 'API',
                                        status: 'ERROR',
                                        message: `Netlify function failed: ${functionError.message}`
                                    }]);
                                }
                            }
                            
                            // Method 3: CORS Proxy (last resort)
                            if (!quotesData) {
                                try {
                                    const proxyUrl = 'https://api.allorigins.win/raw?url=';
                                    const apiUrl = `https://api.kite.trade/quote?i=${instrumentTokens}`;
                                    
                                    const response = await fetch(proxyUrl + encodeURIComponent(apiUrl), {
                                        method: 'GET',
                                        headers: {
                                            'Authorization': `token ${apiConfig.apiKey}:${apiConfig.accessToken}`,
                                            'X-Kite-Version': '3'
                                        }
                                    });
                                    
                                    if (response.ok) {
                                        const data = await response.json();
                                        if (data.status === 'success') {
                                            quotesData = data.data;
                                            setConnectionStatus('connected');
                                            setDebugInfo(prev => [...prev, {
                                                symbol: 'API',
                                                status: 'SUCCESS',
                                                message: 'CORS proxy API call successful!'
                                            }]);
                                        }
                                    }
                                } catch (proxyError) {
                                    setDebugInfo(prev => [...prev, {
                                        symbol: 'API',
                                        status: 'ERROR',
                                        message: `CORS proxy failed: ${proxyError.message}`
                                    }]);
                                }
                            }
                            
                            // Process real data if we got it
                            if (quotesData) {
                                const processedStocks = stockSymbols.map(symbol => {
                                    const stockInfo = stocks[symbol];
                                    const instrumentKey = `NSE:${symbol}`;
                                    const quoteData = quotesData[instrumentKey];
                                    
                                    if (quoteData && quoteData.last_price) {
                                        // Real data from Zerodha
                                        const currentPrice = quoteData.last_price;
                                        const previousClose = quoteData.ohlc.close;
                                        const change = currentPrice - previousClose;
                                        const changePercent = (change / previousClose) * 100;
                                        
                                        const stockData = {
                                            currentPrice: parseFloat(currentPrice.toFixed(2)),
                                            previousClose: parseFloat(previousClose.toFixed(2)),
                                            open: parseFloat(quoteData.ohlc.open.toFixed(2)),
                                            high: parseFloat(quoteData.ohlc.high.toFixed(2)),
                                            low: parseFloat(quoteData.ohlc.low.toFixed(2)),
                                            change: parseFloat(change.toFixed(2)),
                                            changePercent: parseFloat(changePercent.toFixed(2)),
                                            volume: quoteData.volume || 0,
                                            symbol: symbol
                                        };
                                        
                                        const stratAnalysis = calculateSTRATAnalysis(stockData);
                                        
                                        setDebugInfo(prev => [...prev, {
                                            symbol,
                                            status: 'LIVE',
                                            message: `Real NSE data: â‚¹${currentPrice}`
                                        }]);
                                        
                                        return {
                                            symbol: symbol,
                                            sector: stockInfo.sector,
                                            open: `â‚¹${stockData.open}`,
                                            last: `â‚¹${stockData.currentPrice}`,
                                            changePercent: stockData.changePercent.toFixed(2),
                                            change: stockData.change.toFixed(2),
                                            volume: stockData.volume.toLocaleString('en-IN'),
                                            ...stratAnalysis,
                                            timestamp: new Date().toLocaleTimeString('en-IN'),
                                            isLive: true
                                        };
                                    } else {
                                        // Fallback to mock for this specific symbol
                                        const mockData = generateRealisticMockData(symbol, stockInfo);
                                        const stratAnalysis = calculateSTRATAnalysis(mockData);
                                        
                                        setDebugInfo(prev => [...prev, {
                                            symbol,
                                            status: 'MOCK',
                                            message: 'No live data - using mock'
                                        }]);
                                        
                                        return {
                                            symbol: symbol,
                                            sector: stockInfo.sector,
                                            open: `â‚¹${mockData.open.toFixed(2)}`,
                                            last: `â‚¹${mockData.currentPrice.toFixed(2)}`,
                                            changePercent: mockData.changePercent.toFixed(2),
                                            change: mockData.change.toFixed(2),
                                            volume: mockData.volume.toLocaleString('en-IN'),
                                            ...stratAnalysis,
                                            timestamp: new Date().toLocaleTimeString('en-IN'),
                                            isLive: false
                                        };
                                    }
                                });
                                
                                return processedStocks;
                            }
                            
                        } catch (apiError) {
                            setConnectionStatus('error');
                            setDebugInfo(prev => [...prev, {
                                symbol: 'API',
                                status: 'ERROR',
                                message: `All API methods failed: ${apiError.message}`
                            }]);
                        }
                    }
                    
                    // Fallback to demo mode with clear indication
                    setConnectionStatus('demo');
                    setDebugInfo(prev => [...prev, {
                        symbol: 'MODE',
                        status: 'INFO',
                        message: hasRealCredentials ? 'API calls failed - using demo data' : 'No valid credentials - demo mode'
                    }]);
                    
                    const processedStocks = stockSymbols.map(symbol => {
                        const stockInfo = stocks[symbol];
                        const mockData = generateRealisticMockData(symbol, stockInfo);
                        const stratAnalysis = calculateSTRATAnalysis(mockData);
                        
                        setDebugInfo(prev => [...prev, {
                            symbol,
                            status: 'DEMO',
                            message: `Mock price: â‚¹${mockData.currentPrice.toFixed(2)} (NOT REAL)`
                        }]);
                        
                        return {
                            symbol: symbol,
                            sector: stockInfo.sector,
                            open: `â‚¹${mockData.open.toFixed(2)}`,
                            last: `â‚¹${mockData.currentPrice.toFixed(2)}`,
                            changePercent: mockData.changePercent.toFixed(2),
                            change: mockData.change.toFixed(2),
                            volume: mockData.volume.toLocaleString('en-IN'),
                            ...stratAnalysis,
                            timestamp: new Date().toLocaleTimeString('en-IN'),
                            isLive: false
                        };
                    });
                    
                    return processedStocks;
                    
                } catch (error) {
                    console.error('Error fetching stock data:', error);
                    setConnectionStatus('error');
                    setDebugInfo(prev => [...prev, {
                        symbol: 'ERROR',
                        status: 'ERROR',
                        message: `Fatal error: ${error.message}`
                    }]);
                    return [];
                }
            };

            // Auto-refresh
            const toggleAutoRefresh = () => {
                if (autoRefresh) {
                    clearInterval(intervalRef.current);
                    setAutoRefresh(false);
                } else {
                    setAutoRefresh(true);
                    intervalRef.current = setInterval(async () => {
                        if (activeTab === 'scan') {
                            const data = await fetchStockData();
                            setStocks(data);
                            setLastUpdate(new Date());
                        }
                    }, 30000);
                }
            };

            // API config save
            const handleApiConfigSave = () => {
                setShowApiConfig(false);
                if (activeTab === 'scan') {
                    setLoading(true);
                    fetchStockData().then(data => {
                        setStocks(data);
                        setLastUpdate(new Date());
                        setLoading(false);
                    });
                }
            };

            // Connection status helpers
            const getConnectionStatusColor = () => {
                switch (connectionStatus) {
                    case 'connected': return 'bg-green-500';
                    case 'connecting': return 'bg-yellow-500';
                    case 'demo': return 'bg-blue-500';
                    case 'error': return 'bg-red-500';
                    default: return 'bg-gray-500';
                }
            };

            const getConnectionStatusText = () => {
                const hasRealToken = apiConfig.accessToken && apiConfig.accessToken.length > 20 && !apiConfig.accessToken.startsWith('demo_');
                
                switch (connectionStatus) {
                    case 'connected': return 'Zerodha Live';
                    case 'connecting': return 'Connecting...';
                    case 'demo': return hasRealToken ? 'Demo (API Failed)' : 'Demo Mode';
                    case 'error': return 'Connection Error';
                    default: return 'Disconnected';
                }
            };

            // Initial load
            useEffect(() => {
                const loadData = async () => {
                    try {
                        setLoading(true);
                        setError(null);
                        
                        if (activeTab === 'scan') {
                            const data = await fetchStockData();
                            setStocks(data);
                            setLastUpdate(new Date());
                        }
                    } catch (err) {
                        setError(err.message);
                    } finally {
                        setLoading(false);
                    }
                };
                
                loadData();
                
                return () => {
                    if (intervalRef.current) {
                        clearInterval(intervalRef.current);
                    }
                };
            }, [activeTab, apiConfig]);

            // Error state
            if (error) {
                return React.createElement('div', {
                    className: "min-h-screen bg-gray-50 flex items-center justify-center"
                }, React.createElement('div', {
                    className: "text-center max-w-md mx-auto"
                }, [
                    React.createElement('div', { key: 1, className: "text-6xl mb-4" }, 'âš ï¸'),
                    React.createElement('h2', { key: 2, className: "text-2xl font-bold text-gray-900 mb-2" }, 'Application Error'),
                    React.createElement('p', { key: 3, className: "text-gray-600 mb-4" }, error),
                    React.createElement('button', {
                        key: 4,
                        onClick: () => window.location.reload(),
                        className: "bg-orange-600 text-white px-6 py-3 rounded-md hover:bg-orange-700"
                    }, 'Reload Application')
                ]));
            }

            // Loading state
            if (loading && activeTab === 'scan') {
                return React.createElement('div', {
                    className: "min-h-screen bg-gray-50 flex items-center justify-center"
                }, React.createElement('div', {
                    className: "text-center"
                }, [
                    React.createElement('div', {
                        key: 1,
                        className: "animate-spin rounded-full h-16 w-16 border-b-2 border-orange-600 mx-auto mb-4"
                    }),
                    React.createElement('h2', {
                        key: 2,
                        className: "text-xl font-semibold text-gray-700"
                    }, 'Loading Indian STRAT Scanner...'),
                    React.createElement('p', {
                        key: 3,
                        className: "text-gray-500 mt-2"
                    }, 'Initializing live data connection...')
                ]));
            }

            return React.createElement('div', { className: "min-h-screen bg-gray-50" }, [
                // API Configuration Modal
                showApiConfig && React.createElement('div', {
                    key: 'api-modal',
                    className: "fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
                }, React.createElement('div', {
                    className: "relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"
                }, [
                    React.createElement('h3', {
                        key: 1,
                        className: "text-lg font-medium text-gray-900 mb-4"
                    }, 'API Configuration'),
                    React.createElement('div', { key: 2, className: "space-y-4" }, [
                        React.createElement('div', { key: 1 }, [
                            React.createElement('label', {
                                key: 1,
                                className: "block text-sm font-medium text-gray-700"
                            }, 'API Key'),
                            React.createElement('input', {
                                key: 2,
                                type: 'text',
                                value: apiConfig.apiKey,
                                onChange: (e) => setApiConfig(prev => ({...prev, apiKey: e.target.value})),
                                className: "mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm",
                                placeholder: 'Enter API key'
                            })
                        ]),
                        React.createElement('div', { key: 2 }, [
                            React.createElement('label', {
                                key: 1,
                                className: "block text-sm font-medium text-gray-700"
                            }, 'Access Token'),
                            React.createElement('input', {
                                key: 2,
                                type: 'text',
                                value: apiConfig.accessToken,
                                onChange: (e) => setApiConfig(prev => ({...prev, accessToken: e.target.value})),
                                className: "mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm",
                                placeholder: 'Generated via OAuth'
                            })
                        ])
                    ]),
                    React.createElement('div', { key: 3, className: "flex justify-end space-x-3 mt-6" }, [
                        React.createElement('button', {
                            key: 1,
                            onClick: () => setShowApiConfig(false),
                            className: "px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"
                        }, 'Cancel'),
                        React.createElement('button', {
                            key: 2,
                            onClick: handleApiConfigSave,
                            className: "px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700"
                        }, 'Save')
                    ])
                ])),

                // Header
                React.createElement('div', {
                    key: 'header',
                    className: "bg-white shadow-sm border-b"
                }, React.createElement('div', {
                    className: "max-w-7xl mx-auto px-4 py-4"
                }, [
                    React.createElement('div', { key: 1, className: "flex justify-between items-center mb-4" }, [
                        React.createElement('div', { key: 1 }, [
                            React.createElement('h1', {
                                key: 1,
                                className: "text-2xl font-bold text-gray-900 flex items-center"
                            }, [
                                'ðŸ‡®ðŸ‡³ Indian STRAT Scanner',
                                React.createElement('span', {
                                    key: 1,
                                    className: `ml-2 text-sm px-2 py-1 rounded-full ${
                                        connectionStatus === 'connected' ? 'bg-green-100 text-green-800' :
                                        'bg-blue-100 text-blue-800'
                                    }`
                                }, connectionStatus === 'connected' ? 'LIVE' : 'DEMO')
                            ]),
                            React.createElement('p', {
                                key: 2,
                                className: "text-sm text-gray-500"
                            }, "Zerodha Integration Ready â€¢ Rob Smith's STRAT Methodology")
                        ]),
                        React.createElement('div', { key: 2, className: "flex items-center space-x-4" }, [
                            React.createElement('div', { key: 1, className: "text-sm text-gray-600 flex items-center" }, [
                                React.createElement('div', {
                                    key: 1,
                                    className: `w-3 h-3 rounded-full mr-2 ${getConnectionStatusColor()}`
                                }),
                                getConnectionStatusText()
                            ]),
                            lastUpdate && React.createElement('div', {
                                key: 2,
                                className: "text-xs text-gray-500"
                            }, `Updated: ${lastUpdate.toLocaleTimeString()}`),
                            React.createElement('button', {
                                key: 3,
                                onClick: toggleAutoRefresh,
                                className: `px-3 py-2 rounded-md text-sm font-medium ${autoRefresh ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700'}`
                            }, autoRefresh ? 'â¸ï¸ Auto' : 'â–¶ï¸ Auto'),
                            React.createElement('button', {
                                key: 4,
                                onClick: () => setShowApiConfig(true),
                                className: "bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 text-sm"
                            }, 'âš™ï¸ Config'),
                            React.createElement('button', {
                                key: 5,
                                onClick: () => window.location.reload(),
                                className: "bg-orange-600 text-white px-4 py-2 rounded-md hover:bg-orange-700 text-sm"
                            }, 'ðŸ”„ Refresh'),
                            React.createElement('button', {
                                key: 6,
                                onClick: () => setShowDebug(!showDebug),
                                className: "bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 text-sm"
                            }, showDebug ? 'Hide Debug' : 'Debug')
                        ])
                    ]),
                    React.createElement('nav', { key: 2, className: "flex space-x-8 border-b" }, [
                        React.createElement('button', {
                            key: 1,
                            onClick: () => setActiveTab('scan'),
                            className: `py-2 px-1 border-b-2 font-medium text-sm ${activeTab === 'scan' ? 'border-orange-500 text-orange-600' : 'border-transparent text-gray-500'}`
                        }, 'ðŸ“Š Live Scan'),
                        React.createElement('button', {
                            key: 2,
                            onClick: () => setActiveTab('setup'),
                            className: `py-2 px-1 border-b-2 font-medium text-sm ${activeTab === 'setup' ? 'border-orange-500 text-orange-600' : 'border-transparent text-gray-500'}`
                        }, 'âš™ï¸ Setup')
                    ])
                ])),

                // Debug Panel
                showDebug && debugInfo.length > 0 && React.createElement('div', {
                    key: 'debug',
                    className: "max-w-7xl mx-auto px-4 py-4"
                }, React.createElement('div', {
                    className: "bg-gray-900 text-white rounded-lg p-4 mb-4"
                }, [
                    React.createElement('h3', { key: 1, className: "text-lg font-semibold mb-3" }, 'Connection Status'),
                    React.createElement('div', {
                        key: 2,
                        className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"
                    }, debugInfo.map((debug, index) => React.createElement('div', {
                        key: index,
                        className: "bg-gray-800 rounded p-3"
                    }, [
                        React.createElement('div', { key: 1, className: "flex items-center mb-2" }, [
                            React.createElement('span', { key: 1, className: "font-bold text-orange-400" }, debug.symbol),
                            React.createElement('span', {
                                key: 2,
                                className: `ml-2 px-2 py-1 rounded text-xs ${
                                    debug.status === 'SUCCESS' ? 'bg-green-600' :
                                    debug.status === 'ERROR' ? 'bg-red-600' :
                                    debug.status === 'WARNING' ? 'bg-yellow-600' :
                                    'bg-blue-600'
                                }`
                            }, debug.status)
                        ]),
                        React.createElement('div', { key: 2, className: "text-xs text-gray-300" }, debug.message)
                    ])))
                ])),

                // Setup Tab
                activeTab === 'setup' && React.createElement('div', {
                    key: 'setup-content',
                    className: "max-w-7xl mx-auto px-4 py-6"
                }, [
                    React.createElement('div', { key: 1, className: "mb-8" }, [
                        React.createElement('h2', { key: 1, className: "text-2xl font-bold text-gray-900 mb-2" }, 'Zerodha API Setup'),
                        React.createElement('p', { key: 2, className: "text-gray-600" }, 'Configure your Zerodha credentials for live data')
                    ]),

                    React.createElement('div', { key: 2, className: "grid grid-cols-1 md:grid-cols-2 gap-6 mb-8" }, [
                        React.createElement('div', { key: 1, className: "bg-white rounded-lg shadow-sm border p-6" }, [
                            React.createElement('h3', { key: 1, className: "text-lg font-semibold text-gray-900 mb-4" }, 'Current Status'),
                            React.createElement('div', { key: 2, className: "space-y-3" }, [
                                React.createElement('div', { key: 1, className: "flex justify-between items-center" }, [
                                    React.createElement('span', { key: 1, className: "text-sm text-gray-600" }, 'API Key'),
                                    React.createElement('span', {
                                        key: 2,
                                        className: `text-sm font-medium ${apiConfig.apiKey ? 'text-green-600' : 'text-red-600'}`
                                    }, apiConfig.apiKey ? 'âœ“ Set' : 'âœ— Not Set')
                                ]),
                                React.createElement('div', { key: 2, className: "flex justify-between items-center" }, [
                                    React.createElement('span', { key: 1, className: "text-sm text-gray-600" }, 'Access Token'),
                                    React.createElement('span', {
                                        key: 2,
                                        className: `text-sm font-medium ${apiConfig.accessToken ? 'text-green-600' : 'text-red-600'}`
                                    }, apiConfig.accessToken ? 'âœ“ Valid' : 'âœ— Required')
                                ]),
                                React.createElement('div', { key: 3, className: "flex justify-between items-center" }, [
                                    React.createElement('span', { key: 1, className: "text-sm text-gray-600" }, 'Connection'),
                                    React.createElement('span', {
                                        key: 2,
                                        className: `text-sm font-medium ${
                                            connectionStatus === 'connected' ? 'text-green-600' :
                                            connectionStatus === 'demo' ? 'text-blue-600' : 'text-yellow-600'
                                        }`
                                    }, getConnectionStatusText())
                                ])
                            ]),
                            React.createElement('button', {
                                key: 3,
                                onClick: () => setShowApiConfig(true),
                                className: "mt-4 w-full bg-orange-600 text-white px-4 py-2 rounded-md hover:bg-orange-700"
                            }, 'Configure Credentials')
                        ]),

                React.createElement('div', { key: 2, className: "bg-white rounded-lg shadow-sm border p-6" }, [
                    React.createElement('h3', { key: 1, className: "text-lg font-semibold text-gray-900 mb-4" }, 'Function Testing & Debug'),
                    React.createElement('div', { key: 2, className: "space-y-3" }, [
                        React.createElement('div', {
                            key: 1,
                            className: "p-3 rounded-md bg-blue-50 border border-blue-200"
                        }, [
                            React.createElement('div', { key: 1, className: "flex items-center" }, [
                                React.createElement('div', { key: 1, className: "w-3 h-3 rounded-full mr-2 bg-blue-500" }),
                                React.createElement('span', { key: 2, className: "font-medium" }, 'Test Netlify Functions')
                            ]),
                            React.createElement('p', { key: 2, className: "text-sm mt-1" }, 
                                'Test functions with form encoding and detailed logging')
                        ]),
                        React.createElement('button', {
                            key: 2,
                            onClick: testNetlifyFunctions,
                            className: "w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700"
                        }, 'ðŸ§ª Test Functions with Form Data'),
                        
                        React.createElement('div', { key: 3, className: "mt-4 p-3 bg-gray-50 rounded-md" }, [
                            React.createElement('h4', { key: 1, className: "font-medium text-gray-900 mb-2" }, 'Current Credentials Status:'),
                            React.createElement('div', { key: 2, className: "text-xs font-mono space-y-1" }, [
                                React.createElement('div', { key: 1 }, `API Key: ${apiConfig.apiKey || 'NOT SET'}`),
                                React.createElement('div', { key: 2 }, `API Secret: ${apiConfig.apiSecret ? apiConfig.apiSecret.substring(0, 10) + '...' : 'NOT SET'}`),
                                React.createElement('div', { key: 3 }, `Access Token: ${apiConfig.accessToken ? apiConfig.accessToken.substring(0, 10) + '...' : 'NOT SET'}`)
                            ])
                        ]),
                        
                        React.createElement('div', { key: 4, className: "mt-4" }, [
                            React.createElement('h4', { key: 1, className: "font-medium text-gray-900 mb-2" }, 'Kite Connect Login'),
                            React.createElement('div', {
                                key: 2,
                                className: `p-3 rounded-md ${
                                    apiConfig.accessToken ? 'bg-green-50 border border-green-200' : 'bg-yellow-50 border border-yellow-200'
                                }`
                            }, [
                                React.createElement('div', { key: 1, className: "flex items-center" }, [
                                    React.createElement('div', {
                                        key: 1,
                                        className: `w-3 h-3 rounded-full mr-2 ${apiConfig.accessToken ? 'bg-green-500' : 'bg-yellow-500'}`
                                    }),
                                    React.createElement('span', { key: 2, className: "font-medium" }, 
                                        apiConfig.accessToken ? 'Token Active' : 'Login Required')
                                ]),
                                React.createElement('p', { key: 2, className: "text-sm mt-1" }, 
                                    apiConfig.accessToken ? 'You have a valid access token' : 'Complete OAuth flow to get access token')
                            ]),
                            React.createElement('button', {
                                key: 3,
                                onClick: initiateKiteLogin,
                                className: `w-full mt-2 ${apiConfig.accessToken ? 'bg-gray-600' : 'bg-green-600'} text-white px-4 py-2 rounded-md hover:opacity-90`,
                                disabled: !apiConfig.apiKey
                            }, apiConfig.accessToken ? 'Re-authenticate' : 'ðŸ”‘ Login with Kite Connect'),
                            !apiConfig.apiKey && React.createElement('p', {
                                key: 4,
                                className: "text-xs text-red-600 mt-1"
                            }, 'âš ï¸ Configure API Key first before login')
                        ])
                    ])
                ])
                    ]),

                    React.createElement('div', { key: 3, className: "bg-blue-50 border border-blue-200 rounded-lg p-6" }, [
                        React.createElement('h3', { key: 1, className: "text-lg font-semibold text-blue-900 mb-4" }, 'Setup Instructions'),
                        React.createElement('div', { key: 2, className: "space-y-4 text-sm text-blue-800" }, [
                            React.createElement('div', { key: 1 }, [
                                React.createElement('strong', { key: 1 }, '1. Environment Variables: '),
                                'Set REACT_APP_KITE_API_KEY and REACT_APP_KITE_API_SECRET in Netlify'
                            ]),
                            React.createElement('div', { key: 2 }, [
                                React.createElement('strong', { key: 1 }, '2. Redirect URL: '),
                                `Configure ${window.location.origin} in your Kite Connect app`
                            ]),
                            React.createElement('div', { key: 3 }, [
                                React.createElement('strong', { key: 1 }, '3. Daily Login: '),
                                'Access tokens expire daily at 7:30 AM IST'
                            ]),
                            React.createElement('div', { key: 4 }, [
                                React.createElement('strong', { key: 1 }, '4. Live Data: '),
                                'Once authenticated, you\'ll get real NSE/BSE quotes'
                            ])
                        ])
                    ])
                ]),

                // Scan Tab
                activeTab === 'scan' && React.createElement('div', {
                    key: 'scan-content',
                    className: "max-w-7xl mx-auto px-4 py-6"
                }, [
                    React.createElement('div', { key: 1, className: "grid grid-cols-1 md:grid-cols-4 gap-4 mb-6" }, [
                        React.createElement('div', { key: 1, className: "bg-white rounded-lg shadow-sm border p-4" }, [
                            React.createElement('p', { key: 1, className: "text-sm text-gray-500" }, 'Stocks Tracked'),
                            React.createElement('p', { key: 2, className: "text-2xl font-bold text-orange-600" }, stocks.length),
                            React.createElement('p', { key: 3, className: "text-xs text-gray-400 mt-1" }, 
                                `${stocks.filter(s => s.isLive).length} live`)
                        ]),
                        React.createElement('div', { key: 2, className: "bg-white rounded-lg shadow-sm border p-4" }, [
                            React.createElement('p', { key: 1, className: "text-sm text-gray-500" }, 'FTFC Signals'),
                            React.createElement('p', { key: 2, className: "text-2xl font-bold text-green-600" }, 
                                stocks.filter(s => s.ftfc).length),
                            React.createElement('p', { key: 3, className: "text-xs text-gray-400 mt-1" }, 'active')
                        ]),
                        React.createElement('div', { key: 3, className: "bg-white rounded-lg shadow-sm border p-4" }, [
                            React.createElement('p', { key: 1, className: "text-sm text-gray-500" }, 'Buy Signals'),
                            React.createElement('p', { key: 2, className: "text-2xl font-bold text-green-600" }, 
                                stocks.filter(s => s.actionZone && s.actionZone.includes('Buy')).length),
                            React.createElement('p', { key: 3, className: "text-xs text-gray-400 mt-1" }, 'opportunities')
                        ]),
                        React.createElement('div', { key: 4, className: "bg-white rounded-lg shadow-sm border p-4" }, [
                            React.createElement('p', { key: 1, className: "text-sm text-gray-500" }, 'Last Update'),
                            React.createElement('p', { key: 2, className: "text-sm font-bold text-gray-600" }, 
                                lastUpdate ? lastUpdate.toLocaleTimeString() : 'N/A'),
                            React.createElement('p', { key: 3, className: "text-xs text-gray-400 mt-1" }, 
                                autoRefresh ? 'Auto ON' : 'Manual')
                        ])
                    ]),

                    React.createElement('div', { key: 2, className: "bg-white rounded-lg shadow-sm border overflow-hidden" }, [
                        React.createElement('div', { key: 1, className: "px-6 py-4 border-b bg-gray-50" }, 
                            React.createElement('h3', { className: "text-lg font-semibold text-gray-900 flex items-center" }, [
                                connectionStatus === 'connected' ? 'ðŸ”´ Live NSE Data' : 'ðŸ”µ Demo Data',
                                React.createElement('span', {
                                    key: 1,
                                    className: `ml-3 px-2 py-1 rounded text-xs text-white ${getConnectionStatusColor()}`
                                }, getConnectionStatusText())
                            ])
                        ),
                        React.createElement('table', { key: 2, className: "min-w-full divide-y divide-gray-200" }, [
                            React.createElement('thead', { key: 1, className: "bg-gray-50" }, 
                                React.createElement('tr', {}, [
                                    React.createElement('th', { key: 1, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" }, 'Symbol'),
                                    React.createElement('th', { key: 2, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" }, 'Sector'),
                                    React.createElement('th', { key: 3, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" }, 'Price'),
                                    React.createElement('th', { key: 4, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" }, 'Change %'),
                                    React.createElement('th', { key: 5, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" }, 'Volume'),
                                    React.createElement('th', { key: 6, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" }, 'STRAT'),
                                    React.createElement('th', { key: 7, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" }, 'ATR'),
                                    React.createElement('th', { key: 8, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" }, 'Action'),
                                    React.createElement('th', { key: 9, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" }, 'Signals'),
                                    React.createElement('th', { key: 10, className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase" }, 'Status')
                                ])
                            ),
                            React.createElement('tbody', { key: 2, className: "bg-white divide-y divide-gray-200" }, 
                                stocks.length === 0 ? 
                                    React.createElement('tr', {}, React.createElement('td', {
                                        colSpan: "10",
                                        className: "px-6 py-8 text-center text-gray-500"
                                    }, 'Loading stock data...')) :
                                    stocks.map((stock, index) => React.createElement('tr', {
                                        key: stock.symbol,
                                        className: `${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'} ${
                                            stock.actionZone && stock.actionZone.includes('Buy') ? 'border-l-4 border-green-400' :
                                            stock.actionZone && stock.actionZone.includes('Sell') ? 'border-l-4 border-red-400' : ''
                                        }`
                                    }, [
                                        React.createElement('td', { key: 1, className: "px-6 py-4 whitespace-nowrap" }, [
                                            React.createElement('div', { key: 1, className: "text-sm font-medium text-gray-900" }, stock.symbol),
                                            React.createElement('div', { key: 2, className: "text-xs text-gray-500" }, stock.timestamp)
                                        ]),
                                        React.createElement('td', { key: 2, className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, stock.sector),
                                        React.createElement('td', { key: 3, className: "px-6 py-4 whitespace-nowrap" }, [
                                            React.createElement('div', { key: 1, className: "text-sm font-medium text-gray-900" }, stock.last),
                                            React.createElement('div', { key: 2, className: "text-xs text-gray-500" }, `Open: ${stock.open}`)
                                        ]),
                                        React.createElement('td', {
                                            key: 4,
                                            className: `px-6 py-4 whitespace-nowrap text-sm font-medium ${
                                                parseFloat(stock.changePercent) >= 0 ? 'text-green-600' : 'text-red-600'
                                            }`
                                        }, [
                                            React.createElement('div', { key: 1 }, 
                                                `${parseFloat(stock.changePercent) >= 0 ? '+' : ''}${stock.changePercent}%`),
                                            React.createElement('div', { key: 2, className: "text-xs text-gray-500" }, `â‚¹${stock.change}`)
                                        ]),
                                        React.createElement('td', { key: 5, className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, stock.volume),
                                        React.createElement('td', { key: 6, className: "px-6 py-4 whitespace-nowrap" }, [
                                            React.createElement('span', {
                                                key: 1,
                                                className: `inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                                    stock.cc === '1' ? 'bg-gray-100 text-gray-700' :
                                                    stock.cc === '2u' ? 'bg-green-100 text-green-700' :
                                                    stock.cc === '2d' ? 'bg-red-100 text-red-700' :
                                                    stock.cc === '3' ? 'bg-blue-100 text-blue-700' :
                                                    'bg-gray-100 text-gray-400'
                                                }`
                                            }, stock.cc),
                                            React.createElement('div', { key: 2, className: "text-xs text-gray-500 mt-1" }, stock.signal)
                                        ]),
                                        React.createElement('td', { key: 7, className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, 
                                            `${stock.atr}%`),
                                        React.createElement('td', { key: 8, className: "px-6 py-4 whitespace-nowrap" }, 
                                            React.createElement('span', {
                                                className: `inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                                                    stock.actionZone && stock.actionZone.includes('Buy') ? 'bg-green-100 text-green-800' :
                                                    stock.actionZone && stock.actionZone.includes('Sell') ? 'bg-red-100 text-red-800' :
                                                    stock.actionZone === 'Caution' ? 'bg-yellow-100 text-yellow-800' :
                                                    'bg-gray-100 text-gray-800'
                                                }`
                                            }, stock.actionZone || 'Hold')
                                        ),
                                        React.createElement('td', { key: 9, className: "px-6 py-4 whitespace-nowrap" }, 
                                            React.createElement('div', { className: "flex space-x-1" }, [
                                                React.createElement('div', {
                                                    key: 1,
                                                    className: `w-2 h-2 rounded-full ${stock.ftfc ? 'bg-green-500' : 'bg-gray-300'}`,
                                                    title: 'FTFC'
                                                }),
                                                React.createElement('div', {
                                                    key: 2,
                                                    className: `w-2 h-2 rounded-full ${stock.inForce ? 'bg-orange-500' : 'bg-gray-300'}`,
                                                    title: 'In Force'
                                                }),
                                                React.createElement('div', {
                                                    key: 3,
                                                    className: `w-2 h-2 rounded-full ${
                                                        stock.setup === 'Green' ? 'bg-green-500' :
                                                        stock.setup === 'Red' ? 'bg-red-500' : 
                                                        stock.setup === 'Yellow' ? 'bg-yellow-500' :
                                                        stock.setup === 'Orange' ? 'bg-orange-500' : 'bg-gray-300'
                                                    }`,
                                                    title: `Setup: ${stock.setup}`
                                                })
                                            ])
                                        ),
                                        React.createElement('td', { key: 10, className: "px-6 py-4 whitespace-nowrap" }, 
                                            React.createElement('span', {
                                                className: `inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                                                    stock.isLive ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                                                }`
                                            }, [
                                                stock.isLive && React.createElement('div', {
                                                    key: 1,
                                                    className: "w-2 h-2 bg-green-500 rounded-full mr-1 live-indicator"
                                                }),
                                                stock.isLive ? 'Live' : 'Demo'
                                            ])
                                        )
                                    ]))
                            )
                        ])
                    ])
                ]),

                // Footer
                React.createElement('div', {
                    key: 'footer',
                    className: "max-w-7xl mx-auto px-4 py-6"
                }, React.createElement('div', { className: "bg-white rounded-lg shadow-sm border p-6" }, [
                    React.createElement('h3', { key: 1, className: "text-lg font-semibold text-gray-900 mb-4" }, 
                        'Indian STRAT Scanner - Zerodha Integration Ready'),
                    React.createElement('div', { key: 2, className: "grid grid-cols-1 md:grid-cols-3 gap-6" }, [
                        React.createElement('div', { key: 1 }, [
                            React.createElement('h4', { key: 1, className: "font-medium text-gray-900 mb-2" }, 'Features'),
                            React.createElement('div', { key: 2, className: "space-y-2 text-sm text-gray-600" }, [
                                React.createElement('div', { key: 1 }, 'ðŸ”´ Zerodha Kite Connect ready'),
                                React.createElement('div', { key: 2 }, 'ðŸ“Š Real-time STRAT analysis'),
                                React.createElement('div', { key: 3 }, 'âš¡ Auto-refresh functionality'),
                                React.createElement('div', { key: 4 }, 'ðŸŽ¯ Buy/Sell action zones'),
                                React.createElement('div', { key: 5 }, 'ðŸ“± Mobile responsive')
                            ])
                        ]),
                        React.createElement('div', { key: 2 }, [
                            React.createElement('h4', { key: 1, className: "font-medium text-gray-900 mb-2" }, 'STRAT Signals'),
                            React.createElement('div', { key: 2, className: "space-y-2 text-sm text-gray-600" }, [
                                React.createElement('div', { key: 1 }, 'ðŸ“ˆ 1, 2u, 2d, 3 classification'),
                                React.createElement('div', { key: 2 }, 'âš¡ FTFC detection'),
                                React.createElement('div', { key: 3 }, 'ðŸ”¥ In Force momentum'),
                                React.createElement('div', { key: 4 }, 'ðŸ“Š ATR volatility'),
                                React.createElement('div', { key: 5 }, 'ðŸŽ¨ Setup color coding')
                            ])
                        ]),
                        React.createElement('div', { key: 3 }, [
                            React.createElement('h4', { key: 1, className: "font-medium text-gray-900 mb-2" }, 'Deployment'),
                            React.createElement('div', { key: 2, className: "space-y-2 text-sm text-gray-600" }, [
                                React.createElement('div', { key: 1 }, 'ðŸŒ Netlify ready'),
                                React.createElement('div', { key: 2 }, 'ðŸ” Environment variables'),
                                React.createElement('div', { key: 3 }, 'ðŸš« No server required'),
                                React.createElement('div', { key: 4 }, 'ðŸ”„ Automatic fallback'),
                                React.createElement('div', { key: 5 }, 'âœ… Error handling')
                            ])
                        ])
                    ]),
                    React.createElement('div', { key: 3, className: "mt-6 pt-6 border-t text-center" }, [
                        React.createElement('div', {
                            key: 1,
                            className: `inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${
                                connectionStatus === 'connected' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'
                            }`
                        }, [
                            React.createElement('div', { key: 1, className: `w-2 h-2 rounded-full mr-2 ${getConnectionStatusColor()}` }),
                            connectionStatus === 'connected' ? 'âœ… Live Data Ready' : 'ðŸ”µ Demo Mode Active'
                        ]),
                        React.createElement('p', { key: 2, className: "text-sm text-gray-500 mt-2" }, 
                            'ðŸ‡®ðŸ‡³ Indian STRAT Scanner â€¢ Rob Smith\'s Methodology â€¢ NSE/BSE Analysis')
                    ])
                ]))
            ]);
        }

        // Initialize app
        try {
            const root = createRoot(document.getElementById('root'));
            root.render(React.createElement(IndianStratScanner));
            console.log('âœ… Indian STRAT Scanner loaded successfully!');
        } catch (error) {
            console.error('Failed to initialize:', error);
            document.getElementById('root').innerHTML = `
                <div class="error-boundary">
                    <h2>âŒ Initialization Error</h2>
                    <p>Error: ${error.message}</p>
                    <button onclick="window.location.reload()">Reload</button>
                </div>
            `;
        }
    </script>
</body>
</html>